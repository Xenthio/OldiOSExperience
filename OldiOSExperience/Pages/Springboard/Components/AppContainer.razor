@using OldiOSExperience.Data

@* App Container - handles app launching and closing animations *@

@if (CurrentApp != null)
{
    <div class="app-container @(isAnimating ? animationClass : "") @(isVisible ? "visible" : "")"
         @onclick:stopPropagation="true">
        <div class="app-content">
            @if (CurrentApp.Id == 16) @* Settings app *@
            {
                <OldiOSExperience.Apps.Settings.SettingsApp />
            }
            else
            {
                <div style="padding: 40px; color: white; font-size: 32px;">
                    @CurrentApp.Name app coming soon...
                </div>
            }
        </div>
    </div>
}

@code {
    [Parameter]
    public AppInfo? CurrentApp { get; set; }
    
    [Parameter]
    public EventCallback OnClose { get; set; }
    
    private bool isVisible = false;
    private bool isAnimating = false;
    private string animationClass = "";
    private AppInfo? previousApp = null;
    
    protected override async Task OnParametersSetAsync()
    {
        // Check if app changed from something to null (closing)
        if (previousApp != null && CurrentApp == null && isVisible)
        {
            // Closing animation
            isAnimating = true;
            animationClass = "app-closing";
            StateHasChanged();
            
            await Task.Delay(300);
            isVisible = false;
            isAnimating = false;
            StateHasChanged();
        }
        // Check if app changed from null to something (opening)
        else if (CurrentApp != null && !isVisible)
        {
            // Opening animation
            isVisible = true;
            isAnimating = true;
            animationClass = "app-opening";
            StateHasChanged();
            
            await Task.Delay(300);
            isAnimating = false;
            StateHasChanged();
        }
        
        previousApp = CurrentApp;
    }
}
