@* iOS 5 UISlider Component *@

<div class="uislider-container @(FullWidth ? "full-width" : "") @(Disabled ? "disabled" : "")">
    @if (!string.IsNullOrEmpty(MinIcon))
    {
        <img src="@MinIcon" alt="" class="slider-icon min" />
    }
    <div class="uislider-wrapper">
        <input type="range"
               class="uislider"
               min="@Min"
               max="@Max"
               step="@Step"
               value="@Value"
               disabled="@Disabled"
               @oninput="HandleInput"
               @onchange="HandleChange" />
        <div class="slider-track">
            <div class="slider-track-fill" style="width: @FillPercentage%"></div>
        </div>
    </div>
    @if (!string.IsNullOrEmpty(MaxIcon))
    {
        <img src="@MaxIcon" alt="" class="slider-icon max" />
    }
</div>

@code {
    [Parameter]
    public double Value { get; set; } = 50;
    
    [Parameter]
    public EventCallback<double> ValueChanged { get; set; }
    
    [Parameter]
    public double Min { get; set; } = 0;
    
    [Parameter]
    public double Max { get; set; } = 100;
    
    [Parameter]
    public double Step { get; set; } = 1;
    
    [Parameter]
    public bool Disabled { get; set; } = false;
    
    [Parameter]
    public bool FullWidth { get; set; } = true;
    
    [Parameter]
    public string? MinIcon { get; set; }
    
    [Parameter]
    public string? MaxIcon { get; set; }
    
    [Parameter]
    public EventCallback<double> OnChange { get; set; }
    
    private double FillPercentage => ((Value - Min) / (Max - Min)) * 100;
    
    private async Task HandleInput(ChangeEventArgs e)
    {
        if (e.Value != null && double.TryParse(e.Value.ToString(), out var newValue))
        {
            await ValueChanged.InvokeAsync(newValue);
        }
    }
    
    private async Task HandleChange(ChangeEventArgs e)
    {
        if (e.Value != null && double.TryParse(e.Value.ToString(), out var newValue))
        {
            await OnChange.InvokeAsync(newValue);
        }
    }
}
