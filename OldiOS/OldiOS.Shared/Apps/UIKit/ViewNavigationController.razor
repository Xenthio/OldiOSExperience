@implements IDisposable

<CascadingValue Value="this" IsFixed="true">
    <div class="navigation-controller">
        @for (var i = 0; i < viewStack.Count; i++)
        {
            var view = viewStack[i];
            var isActive = i == viewStack.Count - 1;
            var animationClass = "";
            if (isAnimating)
            {
                if (isActive && isPushing) animationClass = "slide-in";
                if (!isActive && isPushing && i == viewStack.Count - 2) animationClass = "slide-out";
                if (!isActive && !isPushing && i == viewStack.Count - 1) animationClass = "slide-out-reverse";
                if (isActive && !isPushing) animationClass = "slide-in-reverse";
            }

            <div class="navigation-view @(isActive ? "active" : "") @animationClass">
                @view
            </div>
        }
    </div>
</CascadingValue>

@code {
    private List<RenderFragment> viewStack = new();
    private bool isAnimating = false;
    private bool isPushing = false;

    [Parameter]
    public required RenderFragment RootView { get; set; }

    protected override void OnInitialized()
    {
        if (RootView != null)
        {
            viewStack.Add(RootView);
        }
    }

    public async Task Push(RenderFragment view)
    {
        isPushing = true;
        isAnimating = true;
        viewStack.Add(view);
        StateHasChanged();
        await Task.Delay(350); // Animation duration
        isAnimating = false;
        StateHasChanged();
    }

    public async Task Pop()
    {
        if (viewStack.Count > 1)
        {
            isPushing = false;
            isAnimating = true;
            StateHasChanged();
            await Task.Delay(350); // Animation duration
            viewStack.RemoveAt(viewStack.Count - 1);
            isAnimating = false;
            StateHasChanged();
        }
    }

    public void Dispose()
    {
    }
}
