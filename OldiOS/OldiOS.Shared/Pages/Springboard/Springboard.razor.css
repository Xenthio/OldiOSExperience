.springboard-container {
    width: 100%;
    height: 100%;
    position: relative;
    display: flex;
    flex-direction: column;
    transition: transform 0.3s ease-out;
}

.springboard-container.switcher-visible {
    /* Push content up by 189px when app switcher is visible */
    transform: translateY(-189px);
}

/* In Springboard context, the container shift reveals the tray already.
   Keep the AppSwitcher tray at its default off-screen position to avoid double rise. */
.springboard-container.switcher-visible ::deep .app-switcher.visible .app-switcher-tray {
    transform: translateY(100%);
}
.springboard-container.switcher-visible ::deep .app-switcher .app-switcher-dismiss {
    transform: translateY(189px);
}

.springboard-container ::deep .app-icon {
    opacity: 1;
    filter: grayscale(0%);
}
.springboard-container.switcher-visible ::deep .app-icon {
    opacity: 0.5;
    filter: grayscale(100%); 
}

.springboard-container.app-is-open::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: black;
    z-index: 50;
    animation: fadeToBlack 0.3s ease-out forwards;
    pointer-events: none;
}

/* Animate status bar to fade out with black overlay */
.springboard-container.app-is-open ::deep .status-bar,
.springboard-container.debug-animation ::deep .status-bar {
    opacity: 0;
    /* Override: ease-in for outward animation */
    transition: opacity 0.4s ease-in;
}

/* Locked state: springboard's status bar hidden (but not lock screen's) */
.springboard-container.locked > ::deep .status-bar {
    opacity: 0;
    transition: none;
}

/* Unlocking state: status bar fades in */
.springboard-container.unlocking ::deep .status-bar {
    animation: fadeIn 0.4s ease-out forwards;
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

/* Animate page indicators to fade out */
.springboard-container.app-is-open .page-indicator,
.springboard-container.debug-animation .page-indicator {
    opacity: 0;
    /* Override: ease-in for outward animation */
    transition: opacity 0.4s ease-in;
}

/* Locked state: page indicators hidden */
.springboard-container.locked .page-indicator {
    opacity: 0;
    transition: none;
}

/* Unlocking state: page indicators fade in */
.springboard-container.unlocking .page-indicator {
    animation: fadeIn 0.4s ease-out forwards;
}

/* Animate dock to slide down */
.springboard-container.app-is-open .dock,
.springboard-container.debug-animation .dock {
    transform: translateY(calc(250px * 2));
    opacity: 0;
    /* Override: ease-in for outward animation */
    transition: transform 0.4s ease-in,
                opacity 0.4s ease-in;
}

/* Locked state: dock hidden below */
.springboard-container.locked .dock {
    transform: translateY(calc(250px * 2));
    opacity: 0;
    transition: none;
}

/* Unlocking state: dock slides up from bottom */
.springboard-container.unlocking .dock {
    animation: dockSlideUp 0.4s ease-out forwards;
}

@keyframes dockSlideUp {
    from {
        transform: translateY(calc(250px * 2));
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

/* Debug animation button */
.debug-animation-button {
    position: absolute;
    top: 50px;
    right: 20px;
    z-index: 200;
    padding: 10px 20px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 8px;
    font-size: 18px;
    cursor: pointer;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    transition: background 0.2s;
}

.debug-animation-button:hover {
    background: rgba(0, 0, 0, 0.9);
}

.debug-animation-button:active {
    transform: scale(0.95);
}

@keyframes fadeToBlack {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

@keyframes iconScatterOut {
    0% {
        transform: translate(0, 0);
        opacity: 1;
    }
    100% {
        /* Icons pushed radially from screen center using CSS variables */
        transform: translate(var(--scatter-x, 0), var(--scatter-y, 0));
        opacity: 0;
    }
}

@keyframes fadeOut {
    0% {
        opacity: 1;
    }
    100% {
        opacity: 0;
    }
}

@keyframes dockSlideDown {
    0% {
        transform: translateY(0);
        opacity: 1;
    }
    100% {
        transform: translateY(100px);
        opacity: 0;
    }
}

.wallpaper {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: url(/_content/OldiOS.Shared/images/wallpaper.png);
    background-size: cover;
    z-index: 0;
    /* Enable GPU acceleration */
    transform: translateZ(0);
}
.wallpaper::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: url(/_content/OldiOS.Shared/images/wallpaper_gradient_bottom.png);
    background-repeat: repeat-x;
    background-size: auto;
    background-position: bottom;
    z-index: 100;
    pointer-events: none;
}

/* Status bar styling moved to StatusBar.razor.css */
/* But we need to control its animation in Springboard context */
.springboard-container ::deep .status-bar {
    /* Default: ease-out for return animation (status bar fading back in) */
    transition: opacity 0.4s ease-out;
    opacity: 1;
}

/* This is the viewport for our swiping pages */
.springboard-pages-container {
    flex-grow: 1; /* Takes up all available space between status bar and dock */
    position: relative;
    z-index: 1;
    /* Enable GPU acceleration for smoother scrolling */
    transform: translateZ(0);
}

/* This is the "filmstrip" that holds all pages side-by-side */
.springboard-pages-filmstrip {
    display: flex;
    height: 100%;
    /* Dynamic width based on number of pages - will be set inline if needed, but 300% works for 3 pages (spotlight + 2) */
    /* Enable GPU acceleration and optimize for transform animations */
    will-change: transform;
    transform: translateZ(0);
}

/* Each individual page - must be exactly the container width */
.springboard-page {
    min-width: 100%;
    max-width: 100%;
    flex-shrink: 0;
    height: 100%;
    padding: 26px 15px;
    box-sizing: border-box;
    /* Dynamic grid using CSS variables */
    display: grid;
    grid-template-columns: repeat(var(--icon-columns, 4), 1fr);
    grid-template-rows: repeat(var(--icon-rows, 4), 1fr);
    align-items: start;
    justify-items: center;
    /* Clip icons that scatter outside page boundaries */
    overflow-x: clip;
    overflow-y: visible;
    gap: 25px 0px;
    /* Enable GPU acceleration for better performance */
    transform: translateZ(0);
}

/* Global animation styles for springboard icons */
.springboard-container ::deep .app-icon {
    /* Include filter in the transition and keep !important so it wins */
    transition: transform 0.4s ease-out,
                opacity 0.4s ease-out,
                filter 0.3s ease-out,
                -webkit-filter 0.3s ease-out !important;

    /* Ensure a starting value so filter can animate */
    filter: grayscale(0);
    -webkit-filter: grayscale(0);
}

.springboard-container.app-is-open ::deep .app-icon,
.springboard-container.debug-animation ::deep .app-icon {
    transform: translate(calc(var(--scatter-x, 0) * 3), calc(var(--scatter-y, 0) * 3)) !important;
    opacity: 0 !important;
    /* Override: ease-in for outward animation (icons flying out) */
    transition: transform 0.4s ease-in, 
                opacity 0.4s ease-in !important;
}

/* Locked state: icons start scattered (no animation, instant) */
.springboard-container.locked ::deep .app-icon {
    transform: translate(calc(var(--scatter-x, 0) * 3), calc(var(--scatter-y, 0) * 3));
    opacity: 0;
    transition: none; /* No transition when initially locked */
}

/* Unlocking state: icons fly in from scattered positions */
.springboard-container.unlocking ::deep .app-icon {
    /* Icons fly in from scattered positions with ease-out */
    animation: iconFlyIn 0.4s ease-out forwards !important;
    /* Override locked state */
    transition: none !important;
}

@keyframes iconFlyIn {
    from {
        transform: translate(calc(var(--scatter-x, 0) * 3), calc(var(--scatter-y, 0) * 3));
        opacity: 0;
    }
    to {
        transform: translate(0, 0);
        opacity: 1;
    }
}

/* Define radial scatter directions from grid center (1.5, 1.5) for 4x4 grid */
/* Calculated as: direction = (col - 1.5, row - 1.5), normalized and scaled by 100px */

/* Row 0 (top row) */
.springboard-page ::deep .app-icon:nth-child(1) { --scatter-x: -106px; --scatter-y: -106px; } /* (0,0) -> (-1.5, -1.5) normalized */
.springboard-page ::deep .app-icon:nth-child(2) { --scatter-x: -35px; --scatter-y: -107px; } /* (1,0) -> (-0.5, -1.5) */
.springboard-page ::deep .app-icon:nth-child(3) { --scatter-x: 35px; --scatter-y: -107px; }  /* (2,0) -> (0.5, -1.5) */
.springboard-page ::deep .app-icon:nth-child(4) { --scatter-x: 106px; --scatter-y: -106px; }  /* (3,0) -> (1.5, -1.5) */

/* Row 1 (second row) */
.springboard-page ::deep .app-icon:nth-child(5) { --scatter-x: -107px; --scatter-y: -35px; }  /* (0,1) -> (-1.5, -0.5) */
.springboard-page ::deep .app-icon:nth-child(6) { --scatter-x: -71px; --scatter-y: -71px; }   /* (1,1) -> (-0.5, -0.5) */
.springboard-page ::deep .app-icon:nth-child(7) { --scatter-x: 71px; --scatter-y: -71px; }    /* (2,1) -> (0.5, -0.5) */
.springboard-page ::deep .app-icon:nth-child(8) { --scatter-x: 107px; --scatter-y: -35px; }   /* (3,1) -> (1.5, -0.5) */

/* Row 2 (third row) */
.springboard-page ::deep .app-icon:nth-child(9) { --scatter-x: -107px; --scatter-y: 35px; }   /* (0,2) -> (-1.5, 0.5) */
.springboard-page ::deep .app-icon:nth-child(10) { --scatter-x: -71px; --scatter-y: 71px; }   /* (1,2) -> (-0.5, 0.5) */
.springboard-page ::deep .app-icon:nth-child(11) { --scatter-x: 71px; --scatter-y: 71px; }    /* (2,2) -> (0.5, 0.5) */
.springboard-page ::deep .app-icon:nth-child(12) { --scatter-x: 107px; --scatter-y: 35px; }   /* (3,2) -> (1.5, 0.5) */

/* Row 3 (fourth row) */
.springboard-page ::deep .app-icon:nth-child(13) { --scatter-x: -106px; --scatter-y: 106px; } /* (0,3) -> (-1.5, 1.5) */
.springboard-page ::deep .app-icon:nth-child(14) { --scatter-x: -35px; --scatter-y: 107px; }  /* (1,3) -> (-0.5, 1.5) */
.springboard-page ::deep .app-icon:nth-child(15) { --scatter-x: 35px; --scatter-y: 107px; }   /* (2,3) -> (0.5, 1.5) */
.springboard-page ::deep .app-icon:nth-child(16) { --scatter-x: 106px; --scatter-y: 106px; }  /* (3,3) -> (1.5, 1.5) */

/* Dock icons don't scatter - they drop down with the dock (no transform) */
.dock-icons ::deep .app-icon:nth-child(1) { --scatter-x: 0; --scatter-y: 0; }
.dock-icons ::deep .app-icon:nth-child(2) { --scatter-x: 0; --scatter-y: 0; }
.dock-icons ::deep .app-icon:nth-child(3) { --scatter-x: 0; --scatter-y: 0; }
.dock-icons ::deep .app-icon:nth-child(4) { --scatter-x: 0; --scatter-y: 0; }

/* Spotlight page doesn't use grid layout */
.springboard-page.spotlight-container {
    display: block;
    padding: 0;
}

.page-indicator {
    display: flex;
    justify-content: center;
    gap: 12px;
    height: 0px;
    align-items: center;
    z-index: 10;
    /* Default: ease-out for return animation */
    transition: opacity 0.4s ease-out;
    opacity: 1;
}

    .page-indicator .dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background-color: rgba(255, 255, 255, 0.4);
    }

        .page-indicator .dot.active {
            background-color: white;
        }

.dock {
    height: 190px; /* 95pt @2x */
    width: 100%;
    z-index: 10;
    position: relative;
    /* Default: ease-out for return animation (dock sliding back up) */
    transition: transform 0.4s ease-out,
                opacity 0.4s ease-out;
    transform: translateY(0);
    opacity: 1;
    /* Enable GPU acceleration for animations */
    will-change: transform, opacity;
}

.dock-background {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: url(/_content/OldiOS.Shared/images/dock.png) no-repeat center bottom;
    background-size: contain;
}

.dock-icons {
    position: relative;
    z-index: 11;
    height: 100%;
    display: flex;
    justify-content: space-around;
    align-items: center;
    margin-top: 14px;
    padding: 0 15px;
}
