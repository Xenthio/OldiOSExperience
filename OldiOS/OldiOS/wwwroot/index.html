<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>OldiOS</title>
    <base href="/" />
    <link rel="stylesheet" href="_content/OldiOS.Shared/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="_content/OldiOS.Shared/css/app.css" />
    <link rel="stylesheet" href="app.css" />
    <link rel="stylesheet" href="OldiOS.styles.css" />
    <link rel="icon" type="image/png" href="_content/OldiOS.Shared/favicon.png" />
</head>

<body>
    <div id="app">
        <div class="boot-wrapper">
            <div class="boot-phone-container">
                <div class="boot-screen-viewport">
                    <img src="_content/OldiOS.Shared/images/apple-logo.png" alt="Apple" class="boot-apple-logo" />
                </div>
                <div class="boot-home-button">
                    <div class="boot-home-button-square"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="_framework/blazor.webview.js" autostart="false"></script>
    <script src="_content/OldiOS.Shared/js/app-animations.js"></script>
    <script src="_content/OldiOS.Shared/js/utils.js"></script>
    <script src="_content/OldiOS.Shared/js/battery.js"></script>
    <script src="_content/OldiOS.Shared/js/pressure.js"></script>
    <script>
        window.getElementWidth = (element) => {
            return element.getBoundingClientRect().width;
        };

        window.getElementBoundingClientRect = (element) => {
            const rect = element.getBoundingClientRect();
            return { x: rect.x, y: rect.y, width: rect.width, height: rect.height };
        };

        window.startPositionTracking = (element, dotNetHelper) => {
            let lastRect = { x: 0, y: 0, width: 0, height: 0 };

            const checkPosition = () => {
                if (!element.isConnected) return; // Stop if element removed

                const rect = element.getBoundingClientRect();

                // Check if changed significantly (ignore sub-pixel jitter)
                if (Math.abs(rect.x - lastRect.x) > 1 ||
                    Math.abs(rect.y - lastRect.y) > 1 ||
                    Math.abs(rect.width - lastRect.width) > 1 ||
                    Math.abs(rect.height - lastRect.height) > 1) {

                    lastRect = rect;
                    dotNetHelper.invokeMethodAsync('OnResize', {
                        x: rect.x,
                        y: rect.y,
                        width: rect.width,
                        height: rect.height,
                        offsetWidth: element.offsetWidth,
                        offsetHeight: element.offsetHeight
                    });
                }

                requestAnimationFrame(checkPosition);
            };

            requestAnimationFrame(checkPosition);
        };

        window.scrollToElementCenter = (container, element) => {
            if (!container || !element) return;
            const containerWidth = container.offsetWidth;
            const elementWidth = element.offsetWidth;
            const elementLeft = element.offsetLeft;

            const scrollLeft = elementLeft - (containerWidth / 2) + (elementWidth / 2);

            container.scrollTo({
                left: scrollLeft,
                behavior: 'auto'
            });
        };

        window.scrollToTab = (container, index) => {
            if (!container) return;
            const list = container.querySelector('.tab-list');
            if (!list) return;
            const items = list.children;
            if (index < 0 || index >= items.length) return;

            const element = items[index];
            window.scrollToElementCenter(container, element);
        };
    </script>

</body>

</html>